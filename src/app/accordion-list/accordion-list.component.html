<div *ngIf="isLoadingClients">
  Carregando lista de clientes...
</div>

<form [formGroup]="form" class="tabela-container" *ngIf="!isLoadingClients">
  <div formArrayName="clients">
    <div *ngFor="let client of clients.controls; let i = index" class="tabela-linha">
      <div [formGroupName]="i">
        
        <app-accordion 
          formControlName="isSelected"
          (opened)="onAccordionOpen(client)">
          
          <div custom-title class="titulo-formatado">
            
            <div class="info-principal">
              <div class="cnpj">{{ client.get('document')?.value }}</div>
              <div class="nome-empresa">{{ client.get('corporateName')?.value }}</div>
            </div>

            <span class="status-tag" [ngClass]="client.get('status')?.value.toLowerCase()">
              {{ client.get('status')?.value }}
            </span>

          </div>
          
          <div class="conteudo-accordion">
            
            <div *ngIf="client.get('isLoadingDetails')?.value" style="padding: 24px; text-align: center;">
              Carregando detalhes da conta...
            </div>

            <div formArrayName="accounts" class="accounts-table" *ngIf="!client.get('isLoadingDetails')?.value">
              
              <div class="accounts-header">
                <div class="header-item">Conta</div>
                <div class="header-item">AgÃªncia</div>
                <div class="header-item">Modalidade</div>
                <div class="header-item">Perfil de Acesso</div>
              </div>

              <div *ngFor="let account of getAccountControls(client); let j = index">
                <div [formGroupName]="j" class="account-row">
                  <div class="cell">{{ account.get('accountNumber')?.value }}</div>
                  <div class="cell">{{ account.get('branchNumber')?.value }}</div>
                  <div class="cell">{{ account.get('accountModel')?.value }}</div>
                  <div class="cell">
                    <app-select
                      formControlName="accessProfile"
                      [options]="getProfileOptions(client)"
                      optionValue="profileId"
                      optionLabel="profileName"
                      placeholder="Selecione o Perfil">
                    </app-select>
                  </div>
                </div>
              </div>

            </div>
          </div>
          
        </app-accordion> 

      </div>
    </div>
  </div>

  <div class="actions-container">
    <button type="button" (click)="onSubmit()">Salvar e Ver no Console</button>
  </div>
</form>