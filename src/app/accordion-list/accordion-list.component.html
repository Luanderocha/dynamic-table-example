<div *ngIf="isLoadingClients" style="padding: 24px; text-align: center;">
  Carregando lista de clientes...
</div>

<div *ngIf="!isLoadingClients">
  
  <div class="tabela-container">
    
    <div *ngFor="let client of paginatedClientControls" class="tabela-linha">
      
      <div [formGroup]="client">
        
        <app-accordion 
          formControlName="isSelected"
          (opened)="onAccordionOpen(client)">
          
          <div custom-title class="titulo-formatado">
            
            <div class="info-principal">
              <div class="cnpj">{{ client.get('document')?.value }}</div>
              <div class="nome-empresa">{{ client.get('corporateName')?.value }}</div>
            </div>

            <span class="status-tag" [ngClass]="client.get('status')?.value.toLowerCase()">
              {{ client.get('status')?.value }}
            </span>

          </div>
          
          <div class="conteudo-accordion">
            
            <div *ngIf="client.get('isLoadingDetails')?.value" style="padding: 24px; text-align: center;">
              Carregando detalhes da conta...
            </div>

            <div formArrayName="accounts" class="accounts-table" *ngIf="!client.get('isLoadingDetails')?.value">
              
              <div class="accounts-header">
                <div class="header-item">Conta</div>
                <div class="header-item">Tipo de Conta</div>
                <div class="header-item">Modalidade</div>
                <div class="header-item">Perfil de Acesso</div>
              </div>

              <div *ngFor="let account of getAccountControls(client); let j = index">
                <div [formGroupName]="j" class="account-row">
                  <div class="cell">{{ account.get('accountNumber')?.value }}</div>
                  <div class="cell">{{ account.get('accountTypeLabel')?.value }}</div>
                  <div class="cell">{{ account.get('accountModel')?.value }}</div>
                  <div class="cell profile-cell">
                    <app-select
                      formControlName="accessProfile"
                      [options]="getProfileOptions(client)"
                      optionValue="profileId"
                      optionLabel="profileName"
                      placeholder="Selecione o Perfil">
                    </app-select>

                    <div class="use-for-all-container">
                      <ng-container *ngIf="j === 0">
                        <input type="checkbox" formControlName="useProfileForAll" id="{{client.get('clientIbpjId')?.value}}-useAll">
                        <label [for]="client.get('clientIbpjId')?.value + '-useAll'">
                          Usar esse perfil em todas as contas dessa empresa
                        </label>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="inner-actions-container" *ngIf="client.get('isDataLoaded')?.value && !client.get('isLoadingDetails')?.value">
              <button type.="button" 
                      class="btn btn-secondary"
                      (click)="limparSelecao(client)">
                  Limpar seleção
              </button>
              <button type="button" 
                      class="btn btn-primary"
                      [disabled]="client.get('accounts')?.invalid"
                      (click)="salvarConfiguracao(client)">
                  Salvar
              </button>
            </div>

          </div>
          
        </app-accordion> 

      </div>
    </div>
  </div>

  <div class="footer-actions-container">
    <button type="button" class="btn btn-primary" (click)="onSubmit()">Salvar e Ver no Console</button>
  </div>
</div> <app-pagination 
  *ngIf="!isLoadingClients && paginationInfo && paginationInfo.totalPages > 1"
  [currentPage]="paginationInfo.number"
  [totalPages]="paginationInfo.totalPages"
  (pageChange)="onPageChange($event)">
</app-pagination>